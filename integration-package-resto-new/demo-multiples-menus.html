<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏆 Sistema de Múltiples Menús - Demo</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="MenuComponents.css">
    <link rel="stylesheet" href="MultipleMenusStyles.css">
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- React CDN para desarrollo -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', system-ui, sans-serif;
            background: #0F172A;
            color: white;
        }
        
        .demo-header {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #8A2BE2, #00FFFF);
            margin-bottom: 2rem;
        }
        
        .demo-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 900;
        }
        
        .demo-header p {
            margin: 0.5rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .loading-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
            gap: 1rem;
        }
        
        .spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #8A2BE2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-screen {
            text-align: center;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .error-screen h2 {
            color: #EF4444;
            margin-bottom: 1rem;
        }
        
        .retry-btn {
            background: #8A2BE2;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }
        
        .retry-btn:hover {
            background: #9D4EDD;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1>🏆 Sistema de Múltiples Menús</h1>
        <p>Demo completa del sistema de navegación entre múltiples menús</p>
    </div>

    <div id="app">
        <div class="loading-screen">
            <div class="spinner"></div>
            <p>Inicializando sistema de menús...</p>
        </div>
    </div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useMemo } = React;

        // 🔧 Configuración (puedes cambiar estos valores)
        const MENU_CONFIG = {
            firebaseConfig: {
                apiKey: "AIzaSyDHi_a1trI35goPoKcNPUDBMOSLKjvZKyc",
                authDomain: "cms-menu-7b4a4.firebaseapp.com",
                projectId: "cms-menu-7b4a4",
                storageBucket: "cms-menu-7b4a4.firebasestorage.app",
                messagingSenderId: "509736809578",
                appId: "1:509736809578:web:15471af092f3b46392c613"
            },
            businessId: "HsuTZWhRVkT88a0WOztELGzJUhl1",
            multipleMenus: {
                enabled: true,
                showMenuSelector: true,
                ui: {
                    showMenuDescriptions: true,
                    showProductImages: true,
                    categoryAccordion: true
                }
            },
            cart: {
                persistBetweenMenus: true,
                showMenuOrigin: true,
                allowMixedMenus: true
            }
        };

        // 🎯 Función para obtener terminología
        function getTerminology(businessType = 'restaurant') {
            const terminology = {
                restaurant: {
                    menuSingular: "menú",
                    menuPlural: "menús",
                    itemSingular: "plato",
                    itemPlural: "platos",
                    categorySingular: "categoría", 
                    categoryPlural: "categorías",
                    cartName: "pedido",
                    addToCartText: "Agregar al pedido"
                },
                store: {
                    menuSingular: "catálogo",
                    menuPlural: "catálogos", 
                    itemSingular: "producto",
                    itemPlural: "productos",
                    categorySingular: "categoría",
                    categoryPlural: "categorías", 
                    cartName: "carrito",
                    addToCartText: "Agregar al carrito"
                }
            };
            return terminology[businessType] || terminology.restaurant;
        }

        // 🏭 SDK simplificado para la demo
        class MenuSDK {
            constructor(firebaseConfig, businessId) {
                // Inicializar Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                this.db = firebase.firestore();
                this.businessId = businessId;
                this.currentMenuId = null;
            }

            async getBusinessInfo() {
                try {
                    const doc = await this.db.collection('businesses').doc(this.businessId).get();
                    return doc.exists ? doc.data() : null;
                } catch (error) {
                    console.error('Error getting business info:', error);
                    throw error;
                }
            }

            async getAvailableMenus() {
                try {
                    const snapshot = await this.db
                        .collection('businesses')
                        .doc(this.businessId)
                        .collection('menus')
                        .where('active', '!=', false)
                        .orderBy('order')
                        .get();
                    
                    const menus = [];
                    for (const doc of snapshot.docs) {
                        const menuData = { id: doc.id, ...doc.data() };
                        
                        // Contar categorías
                        const categoriesSnapshot = await this.db
                            .collection('businesses')
                            .doc(this.businessId)
                            .collection('menus')
                            .doc(doc.id)
                            .collection('categories')
                            .get();
                        
                        menuData.categoriesCount = categoriesSnapshot.size;
                        menus.push(menuData);
                    }
                    
                    return menus;
                } catch (error) {
                    console.error('Error getting menus:', error);
                    throw error;
                }
            }

            switchToMenu(menuId) {
                this.currentMenuId = menuId;
                return this;
            }

            async getMenuById(menuId) {
                try {
                    const menuDoc = await this.db
                        .collection('businesses')
                        .doc(this.businessId)
                        .collection('menus')
                        .doc(menuId)
                        .get();
                    
                    if (!menuDoc.exists) {
                        throw new Error(`Menu ${menuId} not found`);
                    }
                    
                    const menuInfo = menuDoc.data();
                    
                    // Obtener categorías
                    const categoriesSnapshot = await this.db
                        .collection('businesses')
                        .doc(this.businessId)
                        .collection('menus')
                        .doc(menuId)
                        .collection('categories')
                        .orderBy('order')
                        .get();
                    
                    const categories = [];
                    for (const categoryDoc of categoriesSnapshot.docs) {
                        const categoryData = {
                            id: categoryDoc.id,
                            ...categoryDoc.data(),
                            items: []
                        };
                        
                        // Obtener items
                        const itemsSnapshot = await this.db
                            .collection('businesses')
                            .doc(this.businessId)
                            .collection('menus')
                            .doc(menuId)
                            .collection('categories')
                            .doc(categoryDoc.id)
                            .collection('items')
                            .where('isHidden', '!=', true)
                            .orderBy('name')
                            .get();
                        
                        categoryData.items = itemsSnapshot.docs.map(itemDoc => ({
                            id: itemDoc.id,
                            ...itemDoc.data(),
                            menuId: menuId,
                            menuName: menuInfo.name
                        }));
                        
                        if (categoryData.items.length > 0) {
                            categories.push(categoryData);
                        }
                    }
                    
                    return { menuInfo, categories };
                } catch (error) {
                    console.error('Error getting menu:', error);
                    throw error;
                }
            }
        }

        // 🎯 Hook para múltiples menús
        function useMultipleMenus(menuSDK) {
            const [menus, setMenus] = useState([]);
            const [currentMenuId, setCurrentMenuId] = useState(null);
            const [currentMenu, setCurrentMenu] = useState(null);
            const [businessInfo, setBusinessInfo] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                if (!menuSDK) return;

                const loadData = async () => {
                    try {
                        setLoading(true);
                        setError(null);

                        // Cargar business info
                        const business = await menuSDK.getBusinessInfo();
                        setBusinessInfo(business);

                        // Cargar menús
                        const menusData = await menuSDK.getAvailableMenus();
                        setMenus(menusData);

                        // Seleccionar primer menú por defecto
                        if (menusData.length > 0 && !currentMenuId) {
                            const firstMenuId = menusData[0].id;
                            setCurrentMenuId(firstMenuId);
                            menuSDK.switchToMenu(firstMenuId);
                        }

                        setLoading(false);
                    } catch (err) {
                        setError(err.message);
                        setLoading(false);
                    }
                };

                loadData();
            }, [menuSDK]);

            useEffect(() => {
                if (!menuSDK || !currentMenuId) return;

                const loadMenu = async () => {
                    try {
                        const menuData = await menuSDK.getMenuById(currentMenuId);
                        setCurrentMenu(menuData);
                    } catch (err) {
                        setError(err.message);
                    }
                };

                loadMenu();
            }, [menuSDK, currentMenuId]);

            const switchToMenu = (menuId) => {
                setCurrentMenuId(menuId);
                menuSDK.switchToMenu(menuId);
            };

            const terminology = businessInfo ? getTerminology(businessInfo.businessType) : getTerminology('restaurant');

            return {
                menus,
                currentMenuId,
                currentMenu,
                businessInfo,
                loading,
                error,
                switchToMenu,
                terminology
            };
        }

        // 🛒 Hook para carrito
        function useCart() {
            const [cart, setCart] = useState([]);

            const addToCart = (item, quantity = 1) => {
                setCart(prevCart => {
                    const existingIndex = prevCart.findIndex(
                        cartItem => cartItem.item.id === item.id && cartItem.item.menuId === item.menuId
                    );

                    if (existingIndex >= 0) {
                        const updatedCart = [...prevCart];
                        updatedCart[existingIndex].quantity += quantity;
                        return updatedCart;
                    } else {
                        return [...prevCart, { item, quantity }];
                    }
                });
            };

            const removeFromCart = (itemId, menuId) => {
                setCart(prevCart => 
                    prevCart.filter(cartItem => 
                        !(cartItem.item.id === itemId && cartItem.item.menuId === menuId)
                    )
                );
            };

            const clearCart = () => setCart([]);

            const cartTotal = cart.reduce((total, cartItem) => 
                total + (cartItem.item.price * cartItem.quantity), 0
            );

            const cartCount = cart.reduce((total, cartItem) => 
                total + cartItem.quantity, 0
            );

            return {
                cart,
                addToCart,
                removeFromCart,
                clearCart,
                cartTotal,
                cartCount
            };
        }

        // 🏪 Componente Selector de Menús
        function MenuSelector({ menus, currentMenuId, onSelectMenu, terminology }) {
            if (menus.length <= 1) return null;

            return React.createElement('div', { className: 'menu-selector' },
                React.createElement('h2', null, `📋 Selecciona un ${terminology.menuSingular}`),
                React.createElement('div', { className: 'menu-cards' },
                    menus.map(menu =>
                        React.createElement('div', {
                            key: menu.id,
                            className: `menu-card ${currentMenuId === menu.id ? 'selected' : ''}`,
                            onClick: () => onSelectMenu(menu.id)
                        },
                            React.createElement('div', { className: 'menu-card-header' },
                                React.createElement('h3', null, menu.name),
                                currentMenuId === menu.id && 
                                React.createElement('span', { className: 'selected-badge' }, '✓ Actual')
                            ),
                            menu.description && 
                            React.createElement('p', { className: 'menu-description' }, menu.description),
                            React.createElement('div', { className: 'menu-meta' },
                                React.createElement('span', { className: 'categories-count' },
                                    `${menu.categoriesCount || 0} ${terminology.categoryPlural}`
                                )
                            )
                        )
                    )
                )
            );
        }

        // 📂 Componente Acordeón de Categorías
        function CategoryAccordion({ categories, onAddToCart, terminology }) {
            const [openCategories, setOpenCategories] = useState(new Set());

            const toggleCategory = (categoryId) => {
                setOpenCategories(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(categoryId)) {
                        newSet.delete(categoryId);
                    } else {
                        newSet.add(categoryId);
                    }
                    return newSet;
                });
            };

            if (!categories || categories.length === 0) {
                return React.createElement('div', { className: 'no-categories' },
                    React.createElement('p', null, `No hay ${terminology.categoryPlural} disponibles`)
                );
            }

            return React.createElement('div', { className: 'category-accordion' },
                categories.map(category =>
                    React.createElement('div', {
                        key: category.id,
                        className: `category-section ${openCategories.has(category.id) ? 'open' : ''}`
                    },
                        React.createElement('button', {
                            className: 'category-header',
                            onClick: () => toggleCategory(category.id)
                        },
                            React.createElement('h3', null, category.name),
                            React.createElement('span', { className: 'toggle-icon' },
                                openCategories.has(category.id) ? '▼' : '▶'
                            ),
                            React.createElement('span', { className: 'items-count' },
                                `(${category.items.length} ${category.items.length === 1 ? terminology.itemSingular : terminology.itemPlural})`
                            )
                        ),
                        openCategories.has(category.id) &&
                        React.createElement('div', { className: 'category-content' },
                            React.createElement('div', { className: 'product-grid' },
                                category.items.map(item =>
                                    React.createElement(ProductCard, {
                                        key: item.id,
                                        item: item,
                                        onAddToCart: onAddToCart,
                                        terminology: terminology
                                    })
                                )
                            )
                        )
                    )
                )
            );
        }

        // 🍽️ Componente Tarjeta de Producto
        function ProductCard({ item, onAddToCart, terminology }) {
            const [quantity, setQuantity] = useState(1);

            const handleAddToCart = () => {
                onAddToCart(item, quantity);
                setQuantity(1);
            };

            const itemImage = item.images && item.images.length > 0 ? item.images[0] : item.imageUrl;

            return React.createElement('div', { className: 'product-card' },
                itemImage &&
                React.createElement('div', { className: 'product-image' },
                    React.createElement('img', {
                        src: itemImage,
                        alt: item.name,
                        loading: 'lazy'
                    })
                ),
                React.createElement('div', { className: 'product-info' },
                    React.createElement('h4', { className: 'product-name' }, item.name),
                    item.description &&
                    React.createElement('p', { className: 'product-description' }, item.description),
                    React.createElement('div', { className: 'product-details' },
                        React.createElement('span', { className: 'product-price' },
                            `$${typeof item.price === 'number' ? item.price.toFixed(2) : item.price}`
                        ),
                        item.menuName &&
                        React.createElement('span', { className: 'product-menu-origin' },
                            `📋 ${item.menuName}`
                        )
                    ),
                    React.createElement('div', { className: 'product-actions' },
                        React.createElement('div', { className: 'quantity-selector' },
                            React.createElement('button', {
                                onClick: () => setQuantity(Math.max(1, quantity - 1)),
                                disabled: quantity <= 1
                            }, '-'),
                            React.createElement('span', { className: 'quantity' }, quantity),
                            React.createElement('button', {
                                onClick: () => setQuantity(quantity + 1)
                            }, '+')
                        ),
                        React.createElement('button', {
                            className: 'add-to-cart-btn',
                            onClick: handleAddToCart
                        }, terminology.addToCartText)
                    )
                )
            );
        }

        // 🛒 Componente Carrito Simple
        function SimpleCart({ cart, cartTotal, cartCount, onClearCart, terminology }) {
            const [isOpen, setIsOpen] = useState(false);

            if (cartCount === 0) return null;

            return React.createElement('div', { 
                className: `multi-menu-cart floating ${isOpen ? 'open' : ''}`,
                style: { position: 'fixed', bottom: '2rem', right: '2rem', zIndex: 1000 }
            },
                React.createElement('button', {
                    className: 'cart-toggle',
                    onClick: () => setIsOpen(!isOpen)
                },
                    `🛒 ${cartCount} ${cartCount === 1 ? terminology.itemSingular : terminology.itemPlural}`,
                    React.createElement('span', { className: 'cart-total' }, `$${cartTotal.toFixed(2)}`)
                ),
                isOpen &&
                React.createElement('div', { className: 'cart-content' },
                    React.createElement('div', { className: 'cart-header' },
                        React.createElement('h3', null, `Tu ${terminology.cartName}`),
                        React.createElement('button', {
                            className: 'close-cart',
                            onClick: () => setIsOpen(false)
                        }, '✕')
                    ),
                    React.createElement('div', { className: 'cart-items' },
                        cart.map(cartItem =>
                            React.createElement('div', {
                                key: `${cartItem.item.id}-${cartItem.item.menuId}`,
                                className: 'cart-item'
                            },
                                React.createElement('div', { className: 'item-info' },
                                    React.createElement('h5', null, cartItem.item.name),
                                    React.createElement('span', { className: 'item-price' },
                                        `$${cartItem.item.price.toFixed(2)}`
                                    )
                                ),
                                React.createElement('div', { className: 'item-controls' },
                                    React.createElement('span', null, `x${cartItem.quantity}`)
                                ),
                                React.createElement('div', { className: 'item-total' },
                                    `$${(cartItem.item.price * cartItem.quantity).toFixed(2)}`
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: 'cart-footer' },
                        React.createElement('div', { className: 'cart-total-section' },
                            React.createElement('strong', null, `Total: $${cartTotal.toFixed(2)}`)
                        ),
                        React.createElement('div', { className: 'cart-actions' },
                            React.createElement('button', {
                                className: 'clear-cart-btn',
                                onClick: onClearCart
                            }, `Vaciar ${terminology.cartName}`)
                        )
                    )
                )
            );
        }

        // 🎯 Componente Principal
        function App() {
            const menuSDK = useMemo(() => 
                new MenuSDK(MENU_CONFIG.firebaseConfig, MENU_CONFIG.businessId),
                []
            );

            const {
                menus,
                currentMenuId,
                currentMenu,
                businessInfo,
                loading,
                error,
                switchToMenu,
                terminology
            } = useMultipleMenus(menuSDK);

            const {
                cart,
                addToCart,
                clearCart,
                cartTotal,
                cartCount
            } = useCart();

            if (loading) {
                return React.createElement('div', { className: 'loading-screen' },
                    React.createElement('div', { className: 'spinner' }),
                    React.createElement('p', null, `Cargando ${terminology.menuPlural}...`)
                );
            }

            if (error) {
                return React.createElement('div', { className: 'error-screen' },
                    React.createElement('h2', null, '❌ Error al cargar'),
                    React.createElement('p', null, error),
                    React.createElement('button', {
                        className: 'retry-btn',
                        onClick: () => window.location.reload()
                    }, 'Intentar nuevamente')
                );
            }

            if (!menus || menus.length === 0) {
                return React.createElement('div', { className: 'error-screen' },
                    React.createElement('h2', null, `📋 No hay ${terminology.menuPlural} disponibles`),
                    React.createElement('p', null, 'Contacta al administrador del negocio')
                );
            }

            return React.createElement('div', { className: 'multiple-menus-page' },
                // Header del negocio
                businessInfo &&
                React.createElement('div', { className: 'business-header' },
                    React.createElement('h1', null, businessInfo.name),
                    businessInfo.description &&
                    React.createElement('p', { className: 'business-description' }, businessInfo.description)
                ),

                // Selector de menús
                React.createElement(MenuSelector, {
                    menus: menus,
                    currentMenuId: currentMenuId,
                    onSelectMenu: switchToMenu,
                    terminology: terminology
                }),

                // Menú actual
                currentMenu &&
                React.createElement('div', { className: 'current-menu' },
                    React.createElement('div', { className: 'menu-header' },
                        React.createElement('h2', null, `📋 ${currentMenu.menuInfo?.name}`),
                        currentMenu.menuInfo?.description &&
                        React.createElement('p', { className: 'menu-description' }, currentMenu.menuInfo.description)
                    ),
                    React.createElement(CategoryAccordion, {
                        categories: currentMenu.categories,
                        onAddToCart: addToCart,
                        terminology: terminology
                    })
                ),

                // Carrito
                React.createElement(SimpleCart, {
                    cart: cart,
                    cartTotal: cartTotal,
                    cartCount: cartCount,
                    onClearCart: clearCart,
                    terminology: terminology
                })
            );
        }

        // Renderizar la aplicación
        ReactDOM.render(React.createElement(App), document.getElementById('app'));
    </script>
</body>
</html>
